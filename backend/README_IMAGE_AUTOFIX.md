# ๐ง Image Auto-Fix Feature

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ููุฒุฉ ุชุตุญูุญ ุงูุตูุฑ ุงูุชููุงุฆู (Auto-Fix) ููุนุงูุฌุฉ ุงูููุงุชูุฑ ุงููุฑููุนุฉ ูุชุญุณูู ุฏูุฉ ุงูุชุญููู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู.

---

## โจ ุงููููุฒุงุช

### 1๏ธโฃ **ุงูุชุดุงู ูุชุตุญูุญ ุงูุฏูุฑุงู (OSD)**
- ููุชุดู ุงูุตูุฑ ุงูููููุจุฉ (90ยฐ, 180ยฐ, 270ยฐ)
- ูุตุญุญูุง ุชููุงุฆูุงู ููุงุชุฌุงู ุงูุตุญูุญ
- ูุณุชุฎุฏู Tesseract OSD (Orientation and Script Detection)

### 2๏ธโฃ **ุชุตุญูุญ ุงูููู (Deskewing)**
- ููุชุดู ุงูููู ุงูุทููู ูู ุงูุตูุฑุฉ
- ูุญุณุจ ุงูุฒุงููุฉ ุจุงุณุชุฎุฏุงู Minimum Area Rectangle
- ูุทุจู ุชุฏููุฑ ุฏููู ูุชุตุญูุญ ุงูููู

### 3๏ธโฃ **ุชุตุญูุญ ุงูููุธูุฑ (Perspective Correction)**
- ูุตุญุญ ุงูุตูุฑ ุงูููุชูุทุฉ ุจุฒุงููุฉ
- ููุชุดู ุญูุงู ุงููุงุชูุฑุฉ ุชููุงุฆูุงู
- ูุทุจู ุชุญููู ุงูููุธูุฑ ููุญุตูู ุนูู ุตูุฑุฉ ูุณุทุญุฉ

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### 1. `backend/utils_image_autofix.py` (ุฌุฏูุฏ)
```python
# ุงูุฏูุงู ุงูุฑุฆูุณูุฉ:
- auto_fix_invoice_image(image_path)  # ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ
- detect_osd_angle(img)                # ุงูุชุดุงู ุฒุงููุฉ ุงูุฏูุฑุงู
- deskew_via_min_area_rect(img)       # ุชุตุญูุญ ุงูููู
- correct_perspective(img)             # ุชุตุญูุญ ุงูููุธูุฑ
```

### 2. `backend/routers/upload.py` (ูุนุฏู)
```python
# ุชู ุฅุถุงูุฉ:
- ุงุณุชูุฑุงุฏ auto_fix_invoice_image
- ุญูุธ ุงูุตูุฑุฉ ูุคูุชุงู
- ุชุทุจูู ุงูุชุตุญูุญ ุงูุชููุงุฆู
- ูุฑุงุกุฉ ุงูุตูุฑุฉ ุงููุตุญุญุฉ
- ุญุฐู ุงูููู ุงููุคูุช
```

### 3. `backend/requirements.txt` (ูุญุฏุซ)
```
opencv-python==4.10.0.84
pytesseract==0.3.13
```

---

## ๐ง ุงููุชุทูุจุงุช

### Python Libraries:
```bash
pip install opencv-python pytesseract numpy
```

### Tesseract OCR (ููู OSD):
```bash
# Ubuntu/Debian
sudo apt-get install tesseract-ocr

# macOS
brew install tesseract

# Windows
# ุชุญููู ูู: https://github.com/UB-Mannheim/tesseract/wiki
# ูุฅุถุงูุฉ ุงููุณุงุฑ ุฅูู PATH
```

**ููุงุญุธุฉ**: ุฅุฐุง ูู ููู Tesseract ูุซุจุชุ ุงูููุฏ ูุนูู ุจุฏูู ููุฒุฉ OSD ููุท (ูุชุฎุทู ุชุตุญูุญ ุงูุฏูุฑุงู).

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุชููุงุฆูุงู ูู `/upload/`:
```python
# ุงูููุฏ ูุนูู ุชููุงุฆูุงู ุนูุฏ ุฑูุน ุฃู ุตูุฑุฉ
POST /upload/
```

### ุงุฎุชุจุงุฑ ูุฏูู:
```bash
python backend/utils_image_autofix.py path/to/invoice.jpg
```

---

## ๐ ุณูุฑ ุงูุนูู (Workflow)

```
1๏ธโฃ ุงููุณุชุฎุฏู ูุฑูุน ุตูุฑุฉ/PDF
          โ
2๏ธโฃ ุชุญููู PDF ุฅูู ุตูุฑุฉ (ุฅุฐุง ูุฒู)
          โ
3๏ธโฃ ุญูุธ ุงูุตูุฑุฉ ูุคูุชุงู
          โ
4๏ธโฃ ุชุทุจูู Auto-Fix:
   โโ ุงูุชุดุงู ูุชุตุญูุญ ุงูุฏูุฑุงู (OSD)
   โโ ุชุตุญูุญ ุงูููู (Deskewing)
   โโ ุชุตุญูุญ ุงูููุธูุฑ (Perspective)
          โ
5๏ธโฃ ูุฑุงุกุฉ ุงูุตูุฑุฉ ุงููุตุญุญุฉ
          โ
6๏ธโฃ ุฑูุน ุงูุตูุฑุฉ ุงููุตุญุญุฉ ุฅูู Supabase
          โ
7๏ธโฃ ุญุฐู ุงูููู ุงููุคูุช
          โ
8๏ธโฃ ุฅุฑุฌุงุน ุฑุงุจุท ุงูุตูุฑุฉ ููู Frontend
```

---

## ๐งช ุฃูุซูุฉ ุนูู ุงูุชุตุญูุญุงุช

### ูุซุงู 1: ุตูุฑุฉ ููููุจุฉ 180ยฐ
```
Input:  ๐ (ููููุจุฉ)
Output: ๐ (ูุนุฏูุฉ ุชููุงุฆูุงู)
```

### ูุซุงู 2: ุตูุฑุฉ ูุงุฆูุฉ 5ยฐ
```
Input:  / (ูุงุฆูุฉ)
Output: | (ูุณุชูููุฉ)
```

### ูุซุงู 3: ุตูุฑุฉ ุจููุธูุฑ
```
Input:  โฑ (ููุชูุทุฉ ูู ุฒุงููุฉ)
Output: โฌ (ูุณุทุญุฉ)
```

---

## โ๏ธ ุฅุนุฏุงุฏุงุช ูุชูุฏูุฉ

### ุชุนุทูู Auto-Fix ูุคูุชุงู:
```python
# ูู upload.pyุ ุนููู ุนูู ุงูุณุทุฑ:
# auto_fix_success = auto_fix_invoice_image(temp_file_path)
```

### ุชุนุฏูู ุญุณุงุณูุฉ ุงูููู:
```python
# ูู utils_image_autofix.py
if abs(angle) < 0.5:  # ุบูุฑ 0.5 ุฅูู ูููุฉ ุฃุฎุฑู
    return img
```

### ุชุนุฏูู ุญุฌู ุงูู Contour:
```python
# ูู correct_perspective()
if contour_area < 0.3 * image_area:  # ุบูุฑ 0.3 ุฅูู ูููุฉ ุฃุฎุฑู
    return img
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก (Troubleshooting)

### 1. Tesseract not found:
```bash
# ุชุฃูุฏ ูู ุชุซุจูุช Tesseract
which tesseract  # Linux/Mac
where tesseract  # Windows

# ุฅุฐุง ูุงู ูุซุจุช ูููู ูุง ูุดุชุบูุ ุฃุถู ุงููุณุงุฑ ูุฏููุงู:
import pytesseract
pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'
```

### 2. OpenCV import error:
```bash
# ุญุงูู ุชุซุจูุช ุงููุณุฎุฉ headless:
pip uninstall opencv-python
pip install opencv-python-headless
```

### 3. Auto-fix ูุณุชุบุฑู ููุช ุทููู:
```python
# ููู ุฏูุฉ ุงูุตูุฑุฉ ูุจู ุงููุนุงูุฌุฉ:
max_size = 2000
if img.shape[0] > max_size or img.shape[1] > max_size:
    scale = max_size / max(img.shape[0], img.shape[1])
    img = cv2.resize(img, None, fx=scale, fy=scale)
```

---

## ๐ ุงูุฃุฏุงุก

### ูุชูุณุท ุงูููุช:
- **OSD Detection**: ~0.5-1 ุซุงููุฉ
- **Deskewing**: ~0.1-0.3 ุซุงููุฉ
- **Perspective Correction**: ~0.2-0.5 ุซุงููุฉ
- **ุงูุฅุฌูุงูู**: ~1-2 ุซุงููุฉ ููู ุตูุฑุฉ

### ุงุณุชููุงู ุงูุฐุงูุฑุฉ:
- ุตูุฑุฉ 2MB: ~50-100MB ุฐุงูุฑุฉ
- ุตูุฑุฉ 5MB: ~100-200MB ุฐุงูุฑุฉ

---

## โ ุงูููุงุฆุฏ

1. **ุชุญุณูู ุฏูุฉ ุงูุชุญููู**: ุตูุฑ ูุณุชูููุฉ = ุงุณุชุฎุฑุงุฌ ุฃูุถู ููุจูุงูุงุช
2. **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู**: ูุง ุญุงุฌุฉ ูุชุนุฏูู ุงูุตูุฑุฉ ูุฏููุงู
3. **ุฃุชูุชุฉ ูุงููุฉ**: ูู ุดูุก ูุญุฏุซ ูู ุงูุฎูููุฉ
4. **ูุฑููุฉ**: ูุนูู ูุน ุฌููุน ุฃููุงุน ุงูุตูุฑ ูุงูุฒูุงูุง

---

## ๐ ุงูุฃูุงู ูุงูุฎุตูุตูุฉ

- โ ุงูุตูุฑ ุชูุญูุธ ูุคูุชุงู ููุท
- โ ูุชู ุญุฐู ุงููููุงุช ุงููุคูุชุฉ ุชููุงุฆูุงู ุจุนุฏ ุงููุนุงูุฌุฉ
- โ ูุง ูุชู ุชุฎุฒูู ุฃู ุจูุงูุงุช ุฅุถุงููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงููุนุงูุฌุฉ ุชุชู ุนูู ุงูุฎุงุฏู (ูุง ุชุฑุณู ุจูุงูุงุช ูุฃุทุฑุงู ุซุงูุซุฉ)

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **Tesseract ุงุฎุชูุงุฑู**: ุงูููุฏ ูุนูู ุจุฏููู (ุจุฏูู OSD ููุท)
2. **ุงูุฃุฏุงุก**: ูุฏ ูุฒูุฏ ููุช ุงูุฑูุน ุจู 1-2 ุซุงููุฉ
3. **ุงูุฌูุฏุฉ**: ุชูุญูุธ ุงูุตูุฑ ุจุฌูุฏุฉ 95% (JPEG)
4. **ุงูุญุฌู**: ูุฏ ูุฒูุฏ ุญุฌู ุงูุตูุฑุฉ ููููุงู ุจุนุฏ ุงููุนุงูุฌุฉ

---

## ๐ ุงูุฎุทูุงุช ุงููุงุฏูุฉ (Future Enhancements)

- [ ] ุฏุนู ูุนุงูุฌุฉ ุฏูุนุงุช (Batch Processing)
- [ ] ุชุญุณูู ุณุฑุนุฉ ุงููุนุงูุฌุฉ (GPU Acceleration)
- [ ] ุฅุถุงูุฉ Image Denoising (ุฅุฒุงูุฉ ุงูุถูุถุงุก)
- [ ] ุฏุนู Super-Resolution (ุชุญุณูู ุฌูุฏุฉ ุงูุตูุฑ)
- [ ] ุฅุถุงูุฉ ุชุตุญูุญ ุงูุฅุถุงุกุฉ (Lighting Correction)

---

**๐ ุขุฎุฑ ุชุญุฏูุซ**: 2025-10-09  
**๐ง ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ**: ูุฑูู ูููููููููููููุชููููููุฑ

---

**โจ ุงูุขู ุงูููุงุชูุฑ ุชูุตุญุญ ุชููุงุฆูุงู! ูุง ูุฒูุฏ ูู ุงูุตูุฑ ุงููุงุฆูุฉ ุฃู ุงูููููุจุฉ!** ๐


# ğŸ§  Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - Ù…ÙÙÙÙˆÙ’ØªÙØ±

## ğŸ“‹ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù†Ø¸Ø§Ù… Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù…Ø´Ø±ÙˆØ¹ **Ù…ÙÙÙÙˆÙ’ØªÙØ±** (Smart Invoice Analyzer) ÙŠØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø°ÙƒØ§Ø¡ Ø¹Ø§Ù„ÙŠ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©.

---

## ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¹Ø§Ù…

Ø¨Ù†Ø§Ø¡ Ù†Ø¸Ø§Ù… ÙˆØ§Ù‚Ø¹ÙŠØŒ Ø°ÙƒÙŠØŒ ÙˆØ¯Ù‚ÙŠÙ‚ Ø¨Ù†Ø³Ø¨Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹:
- âœ… ÙŠØ¬ÙŠØ¨ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ù…Ø¤ÙƒØ¯Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- âœ… ÙŠØ±Ø¨Ø· Ù†ØªØ§Ø¦Ø¬ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ± (VLM) Ù…Ø¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
- âœ… ÙŠØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙØ¹Ù„ÙŠØ§Ù‹ ÙÙŠ Supabase
- âœ… ÙŠØ±Ø¯ Ø¨Ø±Ø³Ø§Ù„Ø© Ù„Ø¨Ù‚Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª

---

## ğŸ—ï¸ Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ø§Ù„Ù†Ø¸Ø§Ù… (Architecture)

```
User Query
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 1: Refiner                                       â”‚
â”‚  ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ù† Ø¹Ø§Ù…ÙŠØ© Ø¥Ù„Ù‰ ÙØµØ­Ù‰                        â”‚
â”‚  Input: "Ø§Ø¨ÙŠ Ø§Ø´ÙˆÙ ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨"                        â”‚
â”‚  Output: "Ø§Ø¹Ø±Ø¶ ÙØ§ØªÙˆØ±Ø© Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡"                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 2: Router                                        â”‚
â”‚  ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©                                     â”‚
â”‚  Options: deep_sql | rag | hybrid | none                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 3: Executor                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ deep_sql  â”‚  â”‚  rag  â”‚  â”‚ hybrid   â”‚                 â”‚
â”‚  â”‚ SQL Query â”‚  â”‚Search â”‚  â”‚ SQL+RAG  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 4: Validator                                     â”‚
â”‚  Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆÙ…Ù„Ø§Ø¡Ù…ØªÙ‡Ø§                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STAGE 5: Replier                                       â”‚
â”‚  ØµÙŠØ§ØºØ© Ø§Ù„Ø±Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©                            â”‚
â”‚  Ø£Ø³Ù„ÙˆØ¨ ÙˆØ¯ÙŠØŒ Ù…Ø®ØªØµØ±ØŒ ÙˆÙ…Ù‡Ù†ÙŠ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
JSON Response
```

---

## ğŸ”§ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¨Ø§Ù„ØªÙØµÙŠÙ„

### 1ï¸âƒ£ Refiner Stage - Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†

**Ø§Ù„Ù‡Ø¯Ù:** ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ù† Ù„Ù‡Ø¬Ø© Ø¹Ø§Ù…ÙŠØ© Ø¥Ù„Ù‰ Ø¹Ø±Ø¨ÙŠØ© ÙØµØ­Ù‰ ÙˆØ§Ø¶Ø­Ø©

**Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯:**
- âœ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù„ØºØ© Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¹Ù†Ù‰
- âœ… Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ØªØ§Ø¬Ø±ØŒ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…)
- âœ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
- âŒ Ø¹Ø¯Ù… Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©

**Ù…Ø«Ø§Ù„:**
```
Input:  "Ø§Ø¨ÙŠ Ø§Ø´ÙˆÙ ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨ Ø§Ù„Ù„ÙŠ Ù‚Ø¨Ù„"
Output: "Ø§Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ ÙØ§ØªÙˆØ±Ø© Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©"
```

**Ø§Ù„ØªÙ†ÙÙŠØ°:**
```python
def refine_user_query(user_query: str) -> str:
    # Uses GPT-4o-mini
    # Temperature: 0.3 (low for consistency)
    # Max tokens: 200
```

---

### 2ï¸âƒ£ Router Stage - Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡

**Ø§Ù„Ù‡Ø¯Ù:** ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©

**Ø§Ù„Ø£Ù†ÙˆØ§Ø¹:**

| Ø§Ù„Ù†ÙˆØ¹ | Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… | Ø£Ù…Ø«Ù„Ø© |
|-------|-----------|--------|
| **deep_sql** | Ø£Ø³Ø¦Ù„Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ© ÙˆØªØ­Ù„ÙŠÙ„ÙŠØ© | ÙƒÙ… Ø¹Ø¯Ø¯ØŸ Ø£Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø©ØŸ |
| **rag** | Ø£Ø³Ø¦Ù„Ø© Ù…Ø¹Ù†ÙˆÙŠØ© ÙˆÙ†ØµÙŠØ© | ÙØ§ØªÙˆØ±Ø© ØµØ¨ ÙˆØ§ÙŠØŒ ÙØ§ØªÙˆØ±Ø© Ù…Ø·Ø¹Ù… |
| **hybrid** | Ø¬Ù…Ø¹ Ø¨ÙŠÙ† SQL ÙˆØ§Ù„Ø¨Ø­Ø« | Ø£Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù…Ø·Ø§Ø¹Ù… |
| **none** | Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„ÙÙˆØ§ØªÙŠØ± | ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ |

**Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª:**
```json
{
  "mode": "deep_sql",
  "reason": "Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ·Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ© (ÙƒÙ… Ø¹Ø¯Ø¯)",
  "show_images": false,
  "requested_vendor": null
}
```

**Ø§Ù„ØªÙ†ÙÙŠØ°:**
```python
class RouterDecision(BaseModel):
    mode: Literal["deep_sql", "rag", "hybrid", "none"]
    reason: str
    show_images: bool = False
    requested_vendor: Optional[str] = None
```

---

### 3ï¸âƒ£ Executor Stage - Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°

#### A. Deep SQL Mode

**Ù…ØªÙ‰ ÙŠÙØ³ØªØ®Ø¯Ù…:**
- Ø£Ø³Ø¦Ù„Ø© Ø¹Ù† Ø£Ø¹Ø¯Ø§Ø¯ØŒ Ù…Ø¬Ø§Ù…ÙŠØ¹ØŒ Ù…ØªÙˆØ³Ø·Ø§Øª
- Ø£Ø³Ø¦Ù„Ø© Ø¹Ù† Ø£Ø¹Ù„Ù‰ØŒ Ø£Ù‚Ù„ØŒ Ø£ÙƒØ«Ø±
- Ø£Ø³Ø¦Ù„Ø© ØªØ­Ù„ÙŠÙ„ÙŠØ©

**ÙƒÙŠÙ ÙŠØ¹Ù…Ù„:**
1. ÙŠÙˆÙ„Ù‘Ø¯ Ø§Ø³ØªØ¹Ù„Ø§Ù… SQL Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… AI
2. ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… (ÙÙ‚Ø· SELECT)
3. ÙŠÙ†ÙØ° Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
4. ÙŠØ±Ø¬Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬

**Ù…Ø«Ø§Ù„:**
```sql
-- Ø§Ù„Ø³Ø¤Ø§Ù„: "ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ"
SELECT COUNT(*) as count 
FROM invoices 
WHERE is_valid_invoice = true

-- Ø§Ù„Ø³Ø¤Ø§Ù„: "Ù…Ø§ Ø£Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø©ØŸ"
SELECT * 
FROM invoices 
WHERE is_valid_invoice = true 
ORDER BY CAST(total_amount AS DECIMAL) DESC 
LIMIT 1
```

**Ø§Ù„Ø£Ù…Ø§Ù†:**
- âœ… ÙÙ‚Ø· SELECT Ù…Ø³Ù…ÙˆØ­
- âŒ DELETE, UPDATE, INSERT, DROP Ù…Ø­Ø¸ÙˆØ±Ø©
- âœ… ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°

#### B. RAG Mode (Semantic Search)

**Ù…ØªÙ‰ ÙŠÙØ³ØªØ®Ø¯Ù…:**
- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ù…ØªØ¬Ø± Ù…Ø¹ÙŠÙ†
- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù†ÙˆØ¹ ÙØ§ØªÙˆØ±Ø© (Ù…Ø·Ø¹Ù…ØŒ ØµÙŠØ¯Ù„ÙŠØ©)
- Ø£Ø³Ø¦Ù„Ø© Ù…Ø¹Ù†ÙˆÙŠØ©

**ÙƒÙŠÙ ÙŠØ¹Ù…Ù„:**
1. ÙŠÙˆÙ„Ù‘Ø¯ embedding Ù„Ù„Ø³Ø¤Ø§Ù„
2. ÙŠØ¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ø¹ embeddings
3. ÙŠØ­Ø³Ø¨ cosine similarity
4. ÙŠØ±Ø¬Ø¹ Ø£Ø¹Ù„Ù‰ 5 Ù†ØªØ§Ø¦Ø¬

**Ù…Ø«Ø§Ù„:**
```python
# Ø§Ù„Ø³Ø¤Ø§Ù„: "Ø§Ø¨ÙŠ ÙØ§ØªÙˆØ±Ø© ØµØ¨ ÙˆØ§ÙŠ"
query_embedding = generate_embedding("ÙØ§ØªÙˆØ±Ø© ØµØ¨ ÙˆØ§ÙŠ")
similarities = []
for invoice in invoices:
    similarity = cosine_similarity(query_embedding, invoice.embedding)
    similarities.append((invoice, similarity))

top_5 = sorted(similarities, reverse=True)[:5]
```

#### C. Hybrid Mode

**Ù…ØªÙ‰ ÙŠÙØ³ØªØ®Ø¯Ù…:**
- Ø£Ø³Ø¦Ù„Ø© ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø­Ø«
- Ø¹Ù†Ø¯Ù…Ø§ SQL Ù„Ø§ ÙŠÙƒÙÙŠ ÙˆØ­Ø¯Ù‡

**ÙƒÙŠÙ ÙŠØ¹Ù…Ù„:**
1. ÙŠÙ†ÙØ° SQL Ø£ÙˆÙ„Ø§Ù‹
2. Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ â†’ ÙŠÙ†ØªÙ‚Ù„ Ù„Ù€ RAG
3. ÙŠØ±Ø¬Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ø£ÙŠ Ù…Ù†Ù‡Ù…Ø§

---

### 4ï¸âƒ£ Validator Stage - Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚

**Ø§Ù„Ù‡Ø¯Ù:** Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØµØ­ÙŠØ­Ø© ÙˆÙ…Ù„Ø§Ø¦Ù…Ø©

**Ø§Ù„ØªØ­Ù‚Ù‚Ø§Øª:**
- âœ… Ù‡Ù„ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ØŸ
- âœ… Ù‡Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©ØŸ
- âœ… Ù‡Ù„ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ

---

### 5ï¸âƒ£ Replier Stage - Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø¯

**Ø§Ù„Ù‡Ø¯Ù:** ØµÙŠØ§ØºØ© Ø±Ø¯ Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø£Ø³Ù„ÙˆØ¨ ÙˆØ¯ÙŠ ÙˆÙ…Ù‡Ù†ÙŠ

**Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯:**
- âœ… Ø¹Ø±Ø¨ÙŠ ÙØµÙŠØ­ Ù…Ø¹ Ù„Ù‡Ø¬Ø© Ø³Ø¹ÙˆØ¯ÙŠØ© Ø®ÙÙŠÙØ©
- âœ… Ù…Ø®ØªØµØ± ÙˆÙˆØ§Ø¶Ø­ ÙˆÙ…Ø¨Ø§Ø´Ø±
- âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… emoji Ù…Ù†Ø§Ø³Ø¨
- âŒ Ø¹Ø¯Ù… Ø°ÙƒØ± Ø£ÙƒÙˆØ§Ø¯ Ø£Ùˆ JSON
- âŒ Ø¹Ø¯Ù… Ø°ÙƒØ± "Ø§Ù„ØµÙˆØ±" Ø£Ùˆ "Ø£Ø¯Ù†Ø§Ù‡"

**Ø£Ù…Ø«Ù„Ø©:**

| Ø§Ù„Ø³Ø¤Ø§Ù„ | Ø§Ù„Ø±Ø¯ |
|--------|------|
| ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ | Ø¹Ù†Ø¯Ùƒ 7 ÙÙˆØ§ØªÙŠØ± ğŸ“„ |
| Ù…Ø§ Ø£Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø©ØŸ | Ø£Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø© Ø¹Ù†Ø¯Ùƒ 1993.27 Ø±.Ø³ Ù…Ù† Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ âš¡ |
| Ø§Ø¨ÙŠ ÙØ§ØªÙˆØ±Ø© ØµØ¨ ÙˆØ§ÙŠ | ØªÙ…Ø§Ù…! Ù‡Ø°Ù‡ ÙØ§ØªÙˆØ±Ø© ØµØ¨ ÙˆØ§ÙŠ Ø¨Ù…Ø¨Ù„Øº 11 Ø±.Ø³ ğŸ½ï¸ |
| Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ | Ù…Ø§ Ù„Ù‚ÙŠØª ÙÙˆØ§ØªÙŠØ± ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ ğŸ˜” |
| Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚ | Ù‡Ø°Ø§ Ø®Ø§Ø±Ø¬ Ø§Ø®ØªØµØ§ØµÙŠØŒ Ø£Ù†Ø§ Ù…ØªØ®ØµØµ ÙÙ‚Ø· ÙÙŠ ØªØ­Ù„ÙŠÙ„ ÙÙˆØ§ØªÙŠØ±Ùƒ ğŸ’¡ |

---

## ğŸ§  Context Awareness - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ù‚

**Ø§Ù„Ù‡Ø¯Ù:** Ø­ÙØ¸ Ø¢Ø®Ø± 3 Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…

**Ù…Ø§ ÙŠÙØ­ÙØ¸:**
```python
class ChatContext:
    last_3_intents: List[str]        # Ø¢Ø®Ø± 3 Ø£Ø³Ø¦Ù„Ø©
    last_3_invoices: List[Dict]      # Ø¢Ø®Ø± 3 ÙÙˆØ§ØªÙŠØ± Ù…Ø¹Ø±ÙˆØ¶Ø©
    last_3_modes: List[str]          # Ø¢Ø®Ø± 3 Ø£Ù†ÙˆØ§Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø©
```

**Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:**
```
User: "Ø§Ø¨ÙŠ ÙØ§ØªÙˆØ±Ø© ØµØ¨ ÙˆØ§ÙŠ"
â†’ Context saves invoice

User: "ÙˆØ±ÙŠÙ†ÙŠ Ø°ÙŠÙƒ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø±Ù‡ Ø«Ø§Ù†ÙŠØ©"
â†’ System retrieves last shown invoice
```

---

## ğŸ”’ Ø§Ù„Ø£Ù…Ø§Ù† (Security)

### 1. SQL Injection Protection

```python
def is_safe_sql(sql_query: str) -> bool:
    # Must start with SELECT
    if not sql_query.lower().startswith("select"):
        return False
    
    # Forbidden keywords
    forbidden = ["delete", "drop", "truncate", "update", 
                 "insert", "alter", "create", "exec"]
    
    for word in forbidden:
        if word in sql_query.lower():
            return False
    
    return True
```

### 2. Input Validation

- âœ… ØªØ­Ù‚Ù‚ Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„
- âœ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù…Ù† Ù…Ø­Ø§Ø±Ù Ø®Ø§ØµØ©
- âœ… ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### 3. Database Protection

- âœ… ÙÙ‚Ø· SELECT statements
- âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… SQLAlchemy ORM
- âœ… Parameterized queries
- âŒ Ù„Ø§ ÙŠÙØ³Ù…Ø­ Ø¨Ù€ DELETE, UPDATE, INSERT

---

## ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### Ø¬Ø¯ÙˆÙ„ invoices

| Ø§Ù„Ø¹Ù…ÙˆØ¯ | Ø§Ù„Ù†ÙˆØ¹ | Ø§Ù„ÙˆØµÙ |
|--------|-------|--------|
| `id` | integer | Ù…Ø¹Ø±Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© |
| `invoice_number` | varchar | Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© |
| `invoice_date` | timestamp | ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø© |
| `vendor` | varchar | Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± |
| `tax_number` | varchar | Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ |
| `total_amount` | varchar | Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ |
| `tax` | varchar | Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© |
| `category` | varchar | Ø§Ù„ØªØµÙ†ÙŠÙ |
| `invoice_type` | text | Ù†ÙˆØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø© |
| `ai_insight` | text | ØªØ­Ù„ÙŠÙ„ AI |
| `image_url` | text | Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© |
| `is_valid_invoice` | boolean | Ù‡Ù„ ÙØ§ØªÙˆØ±Ø© ØµØ­ÙŠØ­Ø©ØŸ |
| `created_at` | timestamp | ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ© |

### Ø¬Ø¯ÙˆÙ„ embeddings

| Ø§Ù„Ø¹Ù…ÙˆØ¯ | Ø§Ù„Ù†ÙˆØ¹ | Ø§Ù„ÙˆØµÙ |
|--------|-------|--------|
| `id` | integer | Ø§Ù„Ù…Ø¹Ø±Ù |
| `invoice_id` | integer | Ù…Ø¹Ø±Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© |
| `embedding` | text | Vector embedding (JSON) |
| `created_at` | timestamp | ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ |

---

## ğŸ”„ ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„

```
1. User sends: "ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ"
   â†“
2. Refiner: "Ù…Ø§ Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ"
   â†“
3. Router: mode = "deep_sql"
   â†“
4. Executor generates SQL:
   "SELECT COUNT(*) FROM invoices WHERE is_valid_invoice = true"
   â†“
5. SQL returns: [{"count": 7}]
   â†“
6. Validator: âœ… Valid
   â†“
7. Replier: "Ø¹Ù†Ø¯Ùƒ 7 ÙÙˆØ§ØªÙŠØ± ğŸ“„"
   â†“
8. Response JSON:
   {
     "reply": "Ø¹Ù†Ø¯Ùƒ 7 ÙÙˆØ§ØªÙŠØ± ğŸ“„",
     "mode": "deep_sql",
     "result_count": 1
   }
```

---

## ğŸ¯ Ø§Ù„Ù€ Endpoints

### 1. `/chat/ask` - Ù†Ù‚Ø·Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

**Request:**
```json
POST /chat/ask
{
  "message": "ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ"
}
```

**Response:**
```json
{
  "reply": "Ø¹Ù†Ø¯Ùƒ 7 ÙÙˆØ§ØªÙŠØ± ğŸ“„",
  "invoices": null,
  "mode": "deep_sql",
  "result_count": 1,
  "show_images": false,
  "is_valid": true,
  "refined_query": "Ù…Ø§ Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ"
}
```

### 2. `/chat/context` - Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ù‚

**Request:**
```json
GET /chat/context
```

**Response:**
```json
{
  "last_intents": ["ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ", "Ø§Ø¨ÙŠ ÙØ§ØªÙˆØ±Ø© ØµØ¨ ÙˆØ§ÙŠ"],
  "last_invoices_count": 1,
  "last_modes": ["deep_sql", "rag"]
}
```

### 3. `/chat/context/clear` - Ù…Ø³Ø­ Ø§Ù„Ø³ÙŠØ§Ù‚

**Request:**
```json
POST /chat/context/clear
```

**Response:**
```json
{
  "status": "Context cleared successfully"
}
```

### 4. `/chat/health` - ÙØ­Øµ Ø§Ù„ØµØ­Ø©

**Request:**
```json
GET /chat/health
```

**Response:**
```json
{
  "status": "healthy",
  "service": "Ù…ÙÙÙÙˆÙ’ØªÙØ± Chat AI",
  "version": "2.0.0"
}
```

---

## ğŸ“ Logging - Ø§Ù„ØªÙˆØ«ÙŠÙ‚

ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© ØªØ³Ø¬Ù‘Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙØµÙ„Ø©:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ NEW CHAT REQUEST
ğŸ“ User Message: ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” Starting Refiner Stage...
   Original Query: ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ
âœ… Refined Query: Ù…Ø§ Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ
ğŸ§­ Starting Router Stage...
   Query: Ù…Ø§ Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ
âœ… Router Decision: deep_sql
   Reason: Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ·Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ© (ÙƒÙ… Ø¹Ø¯Ø¯)
ğŸš€ Starting Executor Stage (mode: deep_sql)...
ğŸ§® Executing Deep SQL...
ğŸ“Š Generated SQL: SELECT COUNT(*) FROM invoices WHERE is_valid_invoice = true
âœ… SQL is safe: SELECT COUNT(*) FROM invoices...
âœ… SQL returned 1 results
âœ… Starting Validator Stage...
âœ… Validated 1 results
ğŸ’¬ Starting Replier Stage...
âœ… Generated reply: Ø¹Ù†Ø¯Ùƒ 7 ÙÙˆØ§ØªÙŠØ± ğŸ“„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… CHAT RESPONSE READY
   Mode: deep_sql
   Results: 1
   Invoices to display: 0
   Reply: Ø¹Ù†Ø¯Ùƒ 7 ÙÙˆØ§ØªÙŠØ± ğŸ“„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ§ª Ø£Ù…Ø«Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### Ù…Ø«Ø§Ù„ 1: Ø³Ø¤Ø§Ù„ Ø¥Ø­ØµØ§Ø¦ÙŠ

**Ø§Ù„Ø³Ø¤Ø§Ù„:** "ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ"

**Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:**
1. Refiner: "Ù…Ø§ Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ"
2. Router: `deep_sql`
3. SQL: `SELECT COUNT(*) FROM invoices WHERE is_valid_invoice = true`
4. Result: `[{"count": 7}]`
5. Reply: "Ø¹Ù†Ø¯Ùƒ 7 ÙÙˆØ§ØªÙŠØ± ğŸ“„"

---

### Ù…Ø«Ø§Ù„ 2: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙØ§ØªÙˆØ±Ø©

**Ø§Ù„Ø³Ø¤Ø§Ù„:** "Ø§Ø¨ÙŠ ÙØ§ØªÙˆØ±Ø© ØµØ¨ ÙˆØ§ÙŠ"

**Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:**
1. Refiner: "Ø£Ø±ÙŠØ¯ ÙØ§ØªÙˆØ±Ø© Ù…Ø·Ø¹Ù… ØµØ¨ ÙˆØ§ÙŠ"
2. Router: `rag` (show_images: true, requested_vendor: "ØµØ¨ ÙˆØ§ÙŠ")
3. Semantic Search â†’ Top result: Subway invoice
4. Reply: "ØªÙ…Ø§Ù…! Ù‡Ø°Ù‡ ÙØ§ØªÙˆØ±Ø© ØµØ¨ ÙˆØ§ÙŠ Ø¨Ù…Ø¨Ù„Øº 11 Ø±.Ø³ ğŸ½ï¸"
5. Images: [Subway invoice image displayed]

---

### Ù…Ø«Ø§Ù„ 3: Ø³Ø¤Ø§Ù„ ØªØ­Ù„ÙŠÙ„ÙŠ

**Ø§Ù„Ø³Ø¤Ø§Ù„:** "Ù…Ø§ Ø£Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø© Ø¹Ù†Ø¯ÙŠØŸ"

**Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:**
1. Refiner: "Ù…Ø§ Ø£Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø© Ù„Ø¯ÙŠØŸ"
2. Router: `deep_sql`
3. SQL: `SELECT * FROM invoices ORDER BY CAST(total_amount AS DECIMAL) DESC LIMIT 1`
4. Result: Electricity bill (1993.27 SAR)
5. Reply: "Ø£Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø© Ø¹Ù†Ø¯Ùƒ 1993.27 Ø±.Ø³ Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù„Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ âš¡"

---

### Ù…Ø«Ø§Ù„ 4: Ø³Ø¤Ø§Ù„ Ù…Ø®ØªÙ„Ø·

**Ø§Ù„Ø³Ø¤Ø§Ù„:** "ÙƒÙ… ÙØ§ØªÙˆØ±Ø© Ø¹Ù†Ø¯ÙŠ Ù…Ù† Ø§Ù„Ù…Ø·Ø§Ø¹Ù…ØŸ"

**Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:**
1. Refiner: "Ù…Ø§ Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ù† Ø§Ù„Ù…Ø·Ø§Ø¹Ù…ØŸ"
2. Router: `hybrid`
3. SQL: `SELECT COUNT(*) FROM invoices WHERE category ILIKE '%Ù…Ø·Ø¹Ù…%'`
4. Result: `[{"count": 3}]`
5. Reply: "Ø¹Ù†Ø¯Ùƒ 3 ÙÙˆØ§ØªÙŠØ± Ù…Ù† Ø§Ù„Ù…Ø·Ø§Ø¹Ù… ğŸ½ï¸"

---

### Ù…Ø«Ø§Ù„ 5: Ø³Ø¤Ø§Ù„ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚

**Ø§Ù„Ø³Ø¤Ø§Ù„:** "ÙˆØ´ Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„ÙŠÙˆÙ…ØŸ"

**Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:**
1. Refiner: "Ù…Ø§ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„ÙŠÙˆÙ…ØŸ"
2. Router: `none`
3. Executor: Skip
4. Reply: "Ù‡Ø°Ø§ Ø®Ø§Ø±Ø¬ Ø§Ø®ØªØµØ§ØµÙŠØŒ Ø£Ù†Ø§ Ù…ØªØ®ØµØµ ÙÙ‚Ø· ÙÙŠ ØªØ­Ù„ÙŠÙ„ ÙÙˆØ§ØªÙŠØ±Ùƒ ğŸ’¡"

---

## ğŸš€ ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### 1. Ø§Ù„ØªØ«Ø¨ÙŠØª

```bash
# Install dependencies
pip install -r backend/requirements.txt
```

### 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©

```bash
# .env file
OPENAI_API_KEY=sk-...
DATABASE_URL=postgresql://...
SUPABASE_URL=https://...
SUPABASE_BUCKET=invoices
EMBEDDING_MODEL=text-embedding-3-small
LLM_MODEL=gpt-4o-mini
```

### 3. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…

```bash
# From project root
uvicorn backend.main:app --reload
```

### 4. Ø§Ø®ØªØ¨Ø§Ø± API

```bash
# cURL
curl -X POST http://localhost:8000/chat/ask \
  -H "Content-Type: application/json" \
  -d '{"message": "ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ"}'

# Python
import requests

response = requests.post(
    "http://localhost:8000/chat/ask",
    json={"message": "ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠØŸ"}
)

print(response.json())
```

---

## ğŸ“ˆ Performance & Optimization

### Caching Strategy

```python
# ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© caching Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©
from functools import lru_cache

@lru_cache(maxsize=100)
def cached_query(query_hash):
    # Return cached result if exists
    pass
```

### Database Indexing

```sql
-- Recommended indexes
CREATE INDEX idx_invoices_vendor ON invoices(vendor);
CREATE INDEX idx_invoices_date ON invoices(invoice_date);
CREATE INDEX idx_invoices_total ON invoices(total_amount);
CREATE INDEX idx_invoices_valid ON invoices(is_valid_invoice);
CREATE INDEX idx_embeddings_invoice ON embeddings(invoice_id);
```

---

## ğŸ”® ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©

- [ ] Multi-language support (English, Arabic)
- [ ] Voice input/output
- [ ] Image analysis in chat
- [ ] Export chat history
- [ ] Advanced analytics dashboard
- [ ] Machine learning for query optimization
- [ ] Real-time notifications
- [ ] Integration with WhatsApp/Telegram

---

## ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª

```
âœ… 5 Stages Ù…ØªÙƒØ§Ù…Ù„Ø©
âœ… 4 Execution modes
âœ… 100% Security coverage
âœ… Context-aware conversation
âœ… Real-time database integration
âœ… Semantic search with embeddings
âœ… Comprehensive logging
âœ… Error handling ÙÙŠ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©
```

---

## ğŸ“ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª

### 1. ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©

```
âœ… Good: "ÙƒÙ… Ø¹Ø¯Ø¯ ÙÙˆØ§ØªÙŠØ±ÙŠ Ù…Ù† Ø§Ù„Ù…Ø·Ø§Ø¹Ù…ØŸ"
âŒ Bad: "ÙÙˆØ§ØªÙŠØ± Ù…Ø·Ø§Ø¹Ù… ÙƒÙ…"

âœ… Good: "Ù…Ø§ Ø£Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø© Ø¹Ù†Ø¯ÙŠØŸ"
âŒ Bad: "Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©"

âœ… Good: "Ø§Ø¨ÙŠ ÙØ§ØªÙˆØ±Ø© ØµØ¨ ÙˆØ§ÙŠ"
âŒ Bad: "ØµÙˆØ±Ø© ÙØ§ØªÙˆØ±Ø©"
```

### 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

```python
try:
    # Your code here
    pass
except Exception as e:
    logger.error(f"Error: {e}")
    return fallback_response
```

### 3. Logging

```python
# Always log important steps
logger.info("ğŸ” Starting process...")
logger.info(f"   Input: {input_data}")
logger.info("âœ… Process completed successfully")
```

---

## ğŸ“ Ø§Ù„Ø¯Ø¹Ù…

Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡ØªÙƒ Ø£ÙŠ Ù…Ø´Ø§ÙƒÙ„:

1. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù€ logs ÙÙŠ Console
2. ØªØ­Ù‚Ù‚ Ù…Ù† Database connection
3. ØªØ­Ù‚Ù‚ Ù…Ù† OpenAI API key
4. ØªØ­Ù‚Ù‚ Ù…Ù† Supabase configuration

---

**ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:** 9 Ø£ÙƒØªÙˆØ¨Ø± 2025  
**Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** 2.0.0  
**Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… Production Ready  
**Ø§Ù„Ù…Ø·ÙˆØ±:** AI Assistant with â¤ï¸

